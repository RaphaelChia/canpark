(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[603],{1408:function(t,e,n){"use strict";function r(t,e,n,r,a,i,s){try{var c=t[i](s),o=c.value}catch(u){return void n(u)}c.done?e(o):Promise.resolve(o).then(r,a)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(a,i){var s=t.apply(e,n);function c(t){r(s,a,i,c,o,"next",t)}function o(t){r(s,a,i,c,o,"throw",t)}c(void 0)}))}}n.r(e),n.d(e,{default:function(){return b}});var i=n(809),s=n.n(i),c=n(7294),o=n(1490),u=n.n(o),l=(n(2243),n(5893)),h=function(t){var e=t.item,n=(t.index,Number(0)),r=Number(0);for(var a in e.carpark_info)n+=+e.carpark_info[a].lots_available,r+=+e.carpark_info[a].total_lots;return(0,l.jsx)("div",{className:"".concat(u().card," ").concat(0==n?u().full:""," ").concat(n/r>0&&n/r<.2?u().almostFull:""),children:(0,l.jsxs)("div",{className:u().cardContent,style:{width:"100%"},children:[(0,l.jsxs)("div",{className:u().cp_num_availability,children:[(0,l.jsx)("p",{className:u().cp_num,children:e.carpark_number}),(0,l.jsxs)("p",{className:"",children:[n,"/",r]})]}),(0,l.jsx)("div",{children:(0,l.jsx)("p",{children:e.address})})]})})},f=n(4909),p=n.n(f),_=function(t){t.setShowSettings;var e=t.setShowLL,n=t.showLL,r=t.setShowMultiStorey,a=t.ShowMultiStorey,i=t.setShowFreeParking,s=t.ShowFreeParking,c=t.setShowOpenSpaceParking,o=t.ShowOpenSpaceParking;return(0,l.jsx)("div",{className:p().SettingsBox,onBlur:function(){return props.setShowSettings(!1)},children:(0,l.jsxs)("form",{className:p().SettingsForm,children:[(0,l.jsx)("label",{children:(0,l.jsx)("div",{onClick:function(t){return e(!n)},className:"".concat(p().settingsItem," ").concat(n?p().settingsItemSelected:""),children:"Show LatLng"})}),(0,l.jsx)("label",{children:(0,l.jsx)("div",{onClick:function(t){return i(!s)},className:"".concat(p().settingsItem," ").concat(s?p().settingsItemSelected:""),children:"Show Free Parking"})}),(0,l.jsx)("label",{children:(0,l.jsx)("div",{onClick:function(t){return r(!a)},className:"".concat(p().settingsItem," ").concat(a?p().settingsItemSelected:""),children:"Show Multi-Storey"})}),(0,l.jsx)("label",{children:(0,l.jsx)("div",{onClick:function(t){return c(!o)},className:"".concat(p().settingsItem," ").concat(o?p().settingsItemSelected:""),children:"Show Open Carpark"})})]})})},d=n(6158),m=n.n(d),v=function(t,e){var n;return function(){for(var r=this,a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];clearTimeout(n),n=setTimeout((function(){t.apply(r,i)}),e)}},S=function(t,e){var n=e._ne,r=e._sw;return t.lng<n.lng&&t.lng>r.lng&&t.lat>r.lat&&t.lat<n.lat},g=function(){this.a=6378137,this.f=1/298.257223563,this.oLat=1.366666,this.oLon=103.833333,this.oN=38744.572,this.oE=28001.642,this.k=1,this.init=function(){this.b=this.a*(1-this.f),this.e2=2*this.f-this.f*this.f,this.e4=this.e2*this.e2,this.e6=this.e4*this.e2,this.A0=1-this.e2/4-3*this.e4/64-5*this.e6/256,this.A2=3/8*(this.e2+this.e4/4+15*this.e6/128),this.A4=15/256*(this.e4+3*this.e6/4),this.A6=35*this.e6/3072},this.init(),this.computeSVY21=function(t,e){var n=t*Math.PI/180,r=Math.sin(n),a=r*r,i=Math.cos(n),s=i*i,c=s*i,o=c*i,u=o*i,l=u*i,h=l*i,f=this.calcRho(a),p=this.calcV(a),_=p/f,d=Math.tan(n),m=(e-this.oLon)*Math.PI/180,v=this.calcM(t),S=this.calcM(this.oLat),g=m*m,w=g*g,x=w*g,k=_*_,b=k*_,y=d*d,L=y*y,j=L*y,C=g/2*p*r*i,N=w/24*p*r*c*(4*k+_-y),M=x/720*p*r*u*(8*(b*_)*(11-24*y)-28*b*(1-6*y)+k*(1-32*y)-2*_*y+L),T=x*g/40320*p*r*h*(1385-3111*y+543*L-j),O=g/6*s*(_-y),P=w/120*o*(4*b*(1-6*y)+k*(1+8*y)-2*_*y+L),E=x/5040*l*(61-479*y+179*L-j);return{N:this.oN+this.k*(v-S+C+N+M+T),E:this.oE+this.k*p*m*i*(1+O+P+E)}},this.calcM=function(t,e){var n=t*Math.PI/180;return this.a*(this.A0*n-this.A2*Math.sin(2*n)+this.A4*Math.sin(4*n)-this.A6*Math.sin(6*n))},this.calcRho=function(t){return this.a*(1-this.e2)/Math.pow(1-this.e2*t,1.5)},this.calcV=function(t){var e=1-this.e2*t;return this.a/Math.sqrt(e)},this.computeLatLon=function(t,e){var n=t-this.oN,r=this.calcM(this.oLat)+n/this.k,a=(this.a-this.b)/(this.a+this.b),i=a*a,s=i*a,c=i*i,o=this.a*(1-a)*(1-i)*(1+9*i/4+225*c/64)*(Math.PI/180),u=r*Math.PI/(180*o),l=u+(3*a/2-27*s/32)*Math.sin(2*u)+(21*i/16-55*c/32)*Math.sin(4*u)+151*s/96*Math.sin(6*u)+1097*c/512*Math.sin(8*u),h=Math.sin(l),f=h*h,p=this.calcRho(f),_=this.calcV(f),d=_/p,m=d*d,v=m*d,S=v*d,g=Math.tan(l),w=g*g,x=w*w,k=x*w,b=e-this.oE,y=b/(this.k*_),L=y*y,j=L*y,C=j*L,N=C*L,M=g/(this.k*p),T=l-M*(b*y/2)+M*(b*j/24)*(-4*m+9*d*(1-w)+12*w)-M*(b*C/720)*(8*S*(11-24*w)-12*v*(21-71*w)+15*m*(15-98*w+15*x)+180*d*(5*w-3*x)+360*x)+M*(b*N/40320)*(1385-3633*w+4095*x+1575*k),O=1/Math.cos(T),P=y*O,E=j*O/6*(d+2*w),I=C*O/120*(-4*v*(1-6*w)+m*(9-68*w)+72*d*w+24*x),F=N*O/5040*(61+662*w+1320*x+720*k),A=this.oLon*Math.PI/180+P-E+I-F;return{lat:T/(Math.PI/180),lng:A/(Math.PI/180)}}},w=function(t){var e=t.showLL,n=t.getCarparks,r=103.9079,i=1.3985;m().accessToken="pk.eyJ1IjoicmFwaGFlbGNoaWEiLCJhIjoiY2t0d3R2OXZlMTVjazJ3cXR0NWhtbnN5dCJ9.fnsUFjoyGO_FhVlSbF2FCQ";var o=(0,c.useRef)(null),h=(0,c.useRef)(null),f=(0,c.useState)(r),p=f[0],_=f[1],d=(0,c.useState)(i),S=d[0],w=d[1],x=(0,c.useState)(13),k=x[0],b=x[1],y=(0,c.useState)([]),L=y[0],j=y[1],C=(0,c.useState)(!1),N=C[0],M=C[1],T=[[103.6156,1.2198],[104.0142,1.4778]];(0,c.useEffect)((function(){console.log("init map"),h.current=new(m().Map)({container:o.current,style:"mapbox://styles/mapbox/streets-v11?optimize=true",center:[p,S],zoom:k,maxBounds:T});var t=new(m().GeolocateControl)({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0});h.current.addControl(t),h.current.on("move",(function(){_(h.current.getCenter().lng.toFixed(4)),w(h.current.getCenter().lat.toFixed(4)),b(h.current.getZoom().toFixed(2)),E()}))}),[]);var O=function(){var t=a(s().mark((function t(){var e,r,a,i,c,o,u,l,f,p;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return P(),e=new g,t.next=4,n(h.current.getBounds());case 4:for(i in r=t.sent,a=[],r){for(f in c="",o=Number(0),u=Number(0),l="",r[i].carpark_info)o+=+r[i].carpark_info[f].lots_available,u+=+r[i].carpark_info[f].total_lots,c+="<p>Lot Type: ".concat(r[i].carpark_info[f].lot_type,"<br>"),c+="Available: ".concat(r[i].carpark_info[f].lots_available,"/").concat(r[i].carpark_info[f].total_lots," </p>");l=null!=r[i].carpark_info&&r[i].carpark_info.length>1?"#000000":"carpark_info"in r[i]?o/u<.2&&o/u>0?"#ff9100":0==o?"#ff482f":"#0fe950":"#f5f5f5",p=new(m().Marker)({color:l}).setLngLat(e.computeLatLon(r[i].y_coord,r[i].x_coord)).setPopup((new(m().Popup)).setHTML("<p>".concat(r[i].address,"</p><p>").concat(c,"</p>"))).addTo(h.current),a.push(p)}j(a);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),P=function(){for(var t in console.log("clearing markers!"),L)L[t].remove();j([])},E=function(t,e){var n;return function(){for(var r=this,a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];clearTimeout(n),M(!0),n=setTimeout((function(){t.apply(r,i)}),e)}}((function(){M(!1)}),500);return(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{ref:o,className:u().mapContainer}),(0,l.jsxs)("div",{className:u().mapLLContainer,children:[e&&(0,l.jsxs)("div",{className:u().mapLL,children:[S," ",p]}),!N&&(0,l.jsx)("div",{onClick:v(O,300),className:u().flexColCenter+" "+u().btnsearchhere,children:(0,l.jsx)("div",{children:"Search This Area"})})]})]})},x=n(9583),k=function(t){t.mapboxkey;var e=(0,c.useState)([]),n=e[0],r=e[1],i=(0,c.useState)(n),o=i[0],f=i[1],p=(0,c.useState)(!1),d=p[0],m=p[1],k=(0,c.useState)(""),b=k[0],y=k[1],L=(0,c.useState)(!0),j=L[0],C=L[1],N=(0,c.useState)(6),M=N[0],T=(N[1],(0,c.useState)(!0)),O=T[0],P=T[1],E=(0,c.useState)(!1),I=E[0],F=E[1],A=(0,c.useState)(!1),R=A[0],B=A[1],z=(0,c.useState)(!1),J=z[0],U=z[1],q=(0,c.useState)({start:0,end:M}),D=q[0];q[1];(0,c.useEffect)((function(){(function(){var t=a(s().mark((function t(){var e;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=null;case 1:return t.next=4,V();case 4:if(!(e=t.sent)){t.next=7;break}return t.abrupt("break",9);case 7:t.next=1;break;case 9:r(e.items[0].carpark_data),f([]);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[]),(0,c.useEffect)((function(){G()}),[b]);var G=function(){var t=a(s().mark((function t(){var e;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(C(!1),0!=b.length){t.next=5;break}return C(!0),f([]),t.abrupt("return");case 5:return t.prev=5,t.delegateYield(s().mark((function t(){var r,a,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,H(b);case 2:for(e in r=t.sent,a=[],r.result.records)(i=n.filter((function(t){return t.carpark_number.toLowerCase()===r.result.records[e].car_park_no.toLowerCase()}))).length>0&&a.push(Object.assign(r.result.records[e],i[0]));f(a);case 6:case"end":return t.stop()}}),t)}))(),"t0",7);case 7:t.next=12;break;case 9:t.prev=9,t.t1=t.catch(5),console.error("Error Occurred",t.t1);case 12:C(!0);case 13:case"end":return t.stop()}}),t,null,[[5,9]])})));return function(){return t.apply(this,arguments)}}(),H=function(){var t=a(s().mark((function t(e){var n,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat("https://data.gov.sg/api/action/datastore_search?resource_id=139a3035-e624-4f56-b63f-89ae28d4ae4c","&limit=5000").concat(e?"&q="+e:""));case 2:return n=t.sent,t.next=5,n.json();case 5:return r=t.sent,t.abrupt("return",r);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),V=function(){var t=a(s().mark((function t(){var e,n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("https://api.data.gov.sg/v1/transport/carpark-availability");case 2:return e=t.sent,t.next=5,e.json();case 5:return n=t.sent,t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),X=function(){var t=a(s().mark((function t(e){var r,a,i,c,o,u;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("attemping to get carparks"),t.next=3,H();case 3:for(o in r=t.sent,a=r.result.records,i=new g,c=a.filter((function(t){return S(i.computeLatLon(t.y_coord,t.x_coord),e)})))(u=n.filter((function(t){return t.carpark_number.toLowerCase()===c[o].car_park_no.toLowerCase()}))).length>0&&Object.assign(c[o],u[0]);return t.abrupt("return",c);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Z=v((function(t){return y(t.target.value.replace(/[^a-zA-Z\d]/gi,""))}),300);return(0,l.jsxs)("div",{className:u().container,children:[(0,l.jsx)(w,{getCarparks:X,showLL:O}),(0,l.jsxs)("form",{className:u().searchbar,onSubmit:function(t){t.preventDefault()},children:[(0,l.jsx)("input",{autoComplete:"off",type:"text",placeholder:"Search",name:"search_keyword",onKeyUp:Z}),!j&&(0,l.jsx)(x.fCD,{className:u().searchSpinner}),(0,l.jsx)("div",{className:u().settings_btn,onClick:function(){m(!d)},children:(0,l.jsx)(x.p4t,{})})]}),(0,l.jsx)("div",{className:"".concat(u().cardrows),children:o.map((function(t,e){return b.length>0&&e>=D.start&&e<D.end&&(0,l.jsx)(h,{item:t},e)}))}),d&&(0,l.jsx)(_,{setShowSettings:m,setShowLL:P,showLL:O,setShowMultiStorey:B,ShowMultiStorey:R,setShowFreeParking:F,ShowFreeParking:I,setShowOpenSpaceParking:U,ShowOpenSpaceParking:J})]})},b=function(){return(0,l.jsx)("div",{children:(0,l.jsx)(k,{})})}},8169:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/search",function(){return n(1408)}])},4909:function(t){t.exports={SettingsBox:"Settings_SettingsBox__2-01N",SettingsForm:"Settings_SettingsForm__Dte7H",settingsItem:"Settings_settingsItem__1vBR7",settingsItemSelected:"Settings_settingsItemSelected__R35Hr"}},1490:function(t){t.exports={container:"Search_container__kB5_S",cardrows:"Search_cardrows__2Z89q",searchbar:"Search_searchbar__10X40",cp_num:"Search_cp_num__28XIf",settings_btn:"Search_settings_btn__1tOjR",btnsearchhere:"Search_btnsearchhere__BRudj",flexColCenter:"Search_flexColCenter__9Gg_q",search_item:"Search_search_item__1RBgq",main:"Search_main__20U7-",footer:"Search_footer__3OSyZ",title:"Search_title__BCdUb",description:"Search_description__31niI",code:"Search_code__3DHHt",grid:"Search_grid__33Kuu",card:"Search_card__30m7w",cp_num_availability:"Search_cp_num_availability__1JPDt",cardContent:"Search_cardContent__3dwCM",full:"Search_full__3Jnf3",almostFull:"Search_almostFull__Z1vEr",plenty:"Search_plenty__3dvDC",logo:"Search_logo__3FqF0",mapContainer:"Search_mapContainer__Gis_A",mapLLContainer:"Search_mapLLContainer__3p2gc",mapLL:"Search_mapLL__3fUff",searchSpinner:"Search_searchSpinner__5rUwf",rotation:"Search_rotation__1wJwF"}},2243:function(){},4155:function(t){var e,n,r=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function s(t){if(e===setTimeout)return setTimeout(t,0);if((e===a||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"===typeof setTimeout?setTimeout:a}catch(t){e=a}try{n="function"===typeof clearTimeout?clearTimeout:i}catch(t){n=i}}();var c,o=[],u=!1,l=-1;function h(){u&&c&&(u=!1,c.length?o=c.concat(o):l=-1,o.length&&f())}function f(){if(!u){var t=s(h);u=!0;for(var e=o.length;e;){for(c=o,o=[];++l<e;)c&&c[l].run();l=-1,e=o.length}c=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function _(){}r.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];o.push(new p(t,e)),1!==o.length||u||s(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=_,r.addListener=_,r.once=_,r.off=_,r.removeListener=_,r.removeAllListeners=_,r.emit=_,r.prependListener=_,r.prependOnceListener=_,r.listeners=function(t){return[]},r.binding=function(t){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},4405:function(t,e,n){"use strict";n.d(e,{w_:function(){return u}});var r=n(7294),a={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},i=r.createContext&&r.createContext(a),s=function(){return(s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var a in e=arguments[n])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},c=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]])}return n};function o(t){return t&&t.map((function(t,e){return r.createElement(t.tag,s({key:e},t.attr),o(t.child))}))}function u(t){return function(e){return r.createElement(l,s({attr:s({},t.attr)},e),o(t.child))}}function l(t){var e=function(e){var n,a=t.attr,i=t.size,o=t.title,u=c(t,["attr","size","title"]),l=i||e.size||"1em";return e.className&&(n=e.className),t.className&&(n=(n?n+" ":"")+t.className),r.createElement("svg",s({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},e.attr,a,u,{className:n,style:s(s({color:t.color||e.color},e.style),t.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&r.createElement("title",null,o),t.children)};return void 0!==i?r.createElement(i.Consumer,null,(function(t){return e(t)})):e(a)}}},function(t){t.O(0,[801,445,634,774,888,179],(function(){return e=8169,t(t.s=e);var e}));var e=t.O();_N_E=e}]);